id: org.freedesktop.Sdk.Extension.openjdk8
branch: '22.08'
runtime: org.freedesktop.Sdk
runtime-version: '22.08'
build-extension: true
sdk: org.freedesktop.Sdk
separate-locales: false
appstream-compose: false
cleanup:
  - /share/info
  - /share/man
build-options:
  no-debuginfo: true
  strip: true
  prefix: /usr/lib/sdk/openjdk8
  env:
    V: '1'
modules:
  - name: bootstrap-java
    cleanup:
      - '*'
    buildsystem: simple
    sources:
      - type: archive
        dest: bootstrap-java
        only-arches:
          - aarch64
        url: https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u345-b01/OpenJDK8U-jdk_aarch64_linux_hotspot_8u345b01.tar.gz
        sha256: c1965fb24dded7d7944e2da36cd902adf3b7b1d327aaa21ea507cff00a5a0090
      - type: archive
        dest: bootstrap-java
        only-arches:
          - x86_64
        url: https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u345-b01/OpenJDK8U-jdk_x64_linux_hotspot_8u345b01.tar.gz
        sha256: ed6c9db3719895584fb1fd69fc79c29240977675f26631911c5a1dbce07b7d58
    build-commands:
      - mv bootstrap-java $FLATPAK_DEST/
  - name: java
    buildsystem: autotools
    no-parallel-make: true
    config-opts:
      - --with-boot-jdk=/usr/lib/sdk/openjdk8/bootstrap-java
      - --with-jvm-variants=server
      - --with-debug-level=release
      - --with-native-debug-symbols=internal
      - --enable-unlimited-crypto
      - --with-zlib=system
      - --with-giflib=system
      - --with-extra-cxxflags=-O2 -g -Wno-error -std=gnu++98 -fno-delete-null-pointer-checks -fno-lifetime-dse -fcommon
      - --with-extra-cflags=-O2 -g -fstack-protector-strong -Wno-error -fno-delete-null-pointer-checks -fno-lifetime-dse -fcommon
      - --with-extra-ldflags=-Wl,-z,relro -Wl,-z,now
      - --with-milestone=fcs
      - --with-update-version=372
      - --with-build-number=b07
    make-args:
      - JAVAC_FLAGS=-g
      - LOG=trace
      - WARNINGS_ARE_ERRORS=-Wno-error
      - CFLAGS_WARNINGS_ARE_ERRORS=-Wno-error
      - images
    sources:
      - type: git
        url: 'https://github.com/adoptium/jdk8u.git'
        tag: jdk8u372-b07
      - type: shell
        commands:
          - chmod a+x configure
  - name: maven
    buildsystem: simple
    cleanup:
      - '*.cmd'
    sources:
      - type: file
        url: http://archive.apache.org/dist/maven/maven-3/3.8.7/binaries/apache-maven-3.8.7-bin.tar.gz
        dest-filename: apache-maven-bin.tar.gz
        sha512: 21c2be0a180a326353e8f6d12289f74bc7cd53080305f05358936f3a1b6dd4d91203f4cc799e81761cf5c53c5bbe9dcc13bdb27ec8f57ecf21b2f9ceec3c8d27
    build-commands:
      - mkdir -p $FLATPAK_DEST/maven
      - tar xf apache-maven-bin.tar.gz --strip-components=1 --exclude=jansi-native --directory=$FLATPAK_DEST/maven
      - ln -s $FLATPAK_DEST/maven/bin/mvn $FLATPAK_DEST/maven/bin/mvnDebug $FLATPAK_DEST/bin
  - name: scripts
    buildsystem: simple
    sources:
      - type: script
        commands:
          - mkdir -p /app/jre
          - cd /usr/lib/sdk/openjdk8/jvm/java-8-openjdk
          - cp -ra * /app/jre
          - rm -rf /app/jre/src.zip /app/jre/include /app/jre/demo /app/jre/sample
        dest-filename: install.sh
      - type: script
        commands:
          - mkdir -p /app/jdk
          - cd /usr/lib/sdk/openjdk8/jvm/java-8-openjdk
          - cp -ra * /app/jdk
        dest-filename: installjdk.sh
      - type: script
        commands:
          - export JAVA_HOME=/usr/lib/sdk/openjdk8/jvm/java-8-openjdk
          - export PATH=$PATH:/usr/lib/sdk/openjdk8/bin
        dest-filename: enable.sh
    build-commands:
      - (cd /usr/lib/sdk/openjdk8/jvm && ln -s openjdk-1.8.0* java-8-openjdk)
      - cp enable.sh install.sh installjdk.sh /usr/lib/sdk/openjdk8/
  - name: appdata
    buildsystem: simple
    build-commands:
      - mkdir -p ${FLATPAK_DEST}/share/appdata
      - cp org.freedesktop.Sdk.Extension.openjdk8.appdata.xml ${FLATPAK_DEST}/share/appdata
      - appstream-compose --basename=org.freedesktop.Sdk.Extension.openjdk8 --prefix=${FLATPAK_DEST} --origin=flatpak org.freedesktop.Sdk.Extension.openjdk8
    sources:
      - type: file
        path: org.freedesktop.Sdk.Extension.openjdk8.appdata.xml
